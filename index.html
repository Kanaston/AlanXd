<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Toma de decisiones</title>
  <link rel="stylesheet" href="css/bootstrap.css" />
  <!-- CSS -->
  <link rel="stylesheet" href="http://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
  <!-- Default theme -->
  <link rel="stylesheet" href="http://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
  <link rel="stylesheet" href="css/prron.css" />
</head>
<body class="bg">
  <div class="container">
    <div class="col-sm-auto margin-card-bottom margin-card-top">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-sm-3">
              Renglones:
              <input type="text" class="form-control" id="txtRow"/>
            </div>
            <div class="col-sm-2">
              <button type="button" class="btn btn-info" id="btnCatgoria">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
                </svg><br />
                Categoria
              </button>
            </div>
            <div class="col-sm-3">
              Columnas:
              <input type="text" class="form-control" id="txtColumn"/>
            </div>
            <div class="col-sm-2">
              <button type="button" class="btn btn-info" id="btnDemanda">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
                </svg><br />
                Demandas
              </button>
            </div> 
            <div class="col-sm-2">
                valor:
                <input type="text" class="form-control" id="txtV" />
            </div>
          </div>

          <div class="row" id="divPesos">

          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-auto margin-card-bottom">
      <div class="card card-opacity">
        <div class="card-body">
          <div class="row">
            <div class="col-sm-12 text-center">
              <h3>Matriz de datos</h3>
            </div>
            <div class="col-sm-12">
              <table class="table table-bordered text-center" id="tblDatos">
                <thead id="tHead"></thead>
                <tbody id="tBody"></tbody>
              </table>
            </div>
            <div class="col-sm-12">
                <table class="table table-bordered text-center" id="tblReult">
                    <thead id="tHeadR"></thead>
                    <tbody id="tBodyR"></tbody>
                </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/alertify.js"></script>
  <script type="text/javascript" src="js/bootstrap.js"></script>
  <script type="text/javascript" src="js/popper.js"></script>
  <script type="text/javascript" src="js/linq.min.js"></script>
  <script type="text/javascript">
      var objDatos = {
          Categorias_row: [],
          Col_Result: ["#","MAXIMIN","MAXIMAX","LAPLACE","OPTIM-PESIM","MINIMAX"],
          Demandas_col: ["#"],
          Datos: [],
          Pesos:[],
          Maximin: function () {
              var data = Enumerable.from(objDatos.Datos)
                  .orderBy(function (foo) { return foo.Value })
                  .firstOrDefault();
              return Enumerable.from(objDatos.Datos)
                  .where(function (foo) { return foo.Value == data.Value })
                  .toArray();
          },
          Maximax: function () {
              var data = Enumerable.from(objDatos.Datos)
                  .orderByDescending(function (x) { return x.Value })
                  .firstOrDefault();
              return Enumerable.from(objDatos.Datos)
                  .where(function (foo) { return foo.Value == data.Value })
                  .toArray();
          },
          OptimPesim: function (p) {
              var gradoOpti = parseFloat(p) / 100;
              var gradPsi = (100 - parseFloat(p)) / 100;
              
              var ganador = 0;
              var indexGanador = 0;

              for (x = 0; x <= objDatos.Categorias_row.length - 1; x++) {
                  grandote = Enumerable.from(objDatos.Datos)
                      .where(function (foo) { return foo.Category == objDatos.Categorias_row[x] })
                      .orderByDescending(function (foo) { return foo.Value })
                      .firstOrDefault();

                  chiquito = Enumerable.from(objDatos.Datos)
                      .where(function (foo) { return foo.Category == objDatos.Categorias_row[x] })
                      .orderBy(function (foo) { return foo.Value })
                      .firstOrDefault();


                  var result = gradoOpti * grandote.Value + gradPsi * chiquito.Value;
                  if (result >= ganador) {
                      ganador = result;
                      indexGanador = x;
                  }
              }

              return {
                  IndexGanado: indexGanador,
                  ResltadoGanador: ganador,
                  Ganador: objDatos.Categorias_row[indexGanador]
              };
          },
          Laplace: function () {
              var prom = 0;
              var ganador = "";
              for (x = 0; x <= objDatos.Categorias_row.length - 1; x++) {
                  var data = Enumerable.from(objDatos.Datos).where(function (foo) { return foo.Category == objDatos.Categorias_row[x]; }).toArray();

                  var sum = 0;
                  for (y = 0; y <= data.length - 1; y++)
                      sum += parseFloat(data[y].Value);

                  var promAux = sum / data.length;

                  if (promAux >= prom) {
                      prom = promAux;
                      ganador = objDatos.Categorias_row[x];
                  }
                  
              }

              return { Promedio: prom, Ganador: ganador };

          },
          Minimax: function () {
              var value = 50000;
              var ganador = "";
              for (x = 0; x <= objDatos.Categorias_row.length - 1; x++) {
                  var data = Enumerable.from(objDatos.Datos)
                      .where(function (foo) { return foo.Category == objDatos.Categorias_row[x]; })
                      .orderByDescending(function (foo) { return foo.Value })
                      .firstOrDefault();

                  var valueAux = data.Value

                  if (value >= valueAux) {
                      value = valueAux;
                      ganador = objDatos.Categorias_row[x];
                  }

              }

              return { Ganador: ganador, Value: value };
              
          }
      };

      var tHead = $("#tHead");
      var tBody = $("#tBody");
      //var tHeadR = $("#tHeadR");
      //var tBodyR = $("#tBodyR");

      //function fn_build_table_reults() {
      //    if (objDatos.Col_Result.length > 0 && objDatos.Categorias_row.length > 0) {
      //        tHeadR.empty();
      //        trHead = $("<tr />").attr("style", "background-color: #3a3a3a;font-size: 20px;color: white;font-weight: bold;");

      //        $.each(objDatos.Col_Result, function (k, a) {
      //            td = $("<td />").append(a);
      //            trHead.append(td);
      //        });

      //        tHeadR.append(trHead);
      //        tBodyR.empty();

      //        $.each(objDatos.Categorias_row, function (k, a) {
      //            tr = $("<tr />");
      //            tdName = $("<td />").append(a).attr("style", "background-color: #3a3a3a;font-size: 20px;color: white;font-weight: bold;");
      //            tr.append(tdName);
      //            for (x = 0; x <= objDatos.Col_Result.length - 2; x++) {
      //                tdValue = $("<td />").addClass("td-value")
      //                    .data("data-position", x + 1)
      //                    .data("data-obj", { Position: x + 1, Category: a, Value: 0 })
      //                    .attr("id", a + (x + 1).toString())

      //                tr.append(tdValue);

      //                var isAdd = true;
      //                if (objDatos.Datos.length > 0) {
      //                    for (y = 0; y <= objDatos.Datos.length - 1; y++) {
      //                        if (objDatos.Datos[y].Position == (x + 1) && objDatos.Datos[y].Category == a) {
      //                            isAdd = false;
      //                            break;
      //                        }
      //                    }
      //                }

      //                if (isAdd) {
      //                    objDatos.Datos.push({ Position: x + 1, Category: a, Value: 0 });
      //                }
      //            }
      //            tBodyR.append(tr);
      //        });

      //        var valor = parseFloat($("#txtV").val());
      //        var maximin = objDatos.Maximin();
      //        var maximax = objDatos.Maximax();
      //        var laplace = objDatos.Laplace(valor);
      //        var opt_pes = objDatos.OptimPesim();
      //        var minimax = objDatos.Minimax();

      //        console.log(minimax);
      //    }
      //}

      function fn_add_categoria() {
          var value = $("#txtRow").val();
          if (value == "" || value == null || value == undefined) {
              return;
          }

          objDatos.Categorias_row.push(value);
          $("#txtRow").val("");

          fn_build_table();
      }

      function fn_add_demanda() {
          var value = $("#txtColumn").val();

          if (value == "" || value == null || value == undefined) {
              return;
          }

          var data = {
              Position: objDatos.Demandas_col.length,
              Nombre: value
          };

          objDatos.Demandas_col.push(data);
          objDatos.Pesos.push($("<input />")
              .attr("type", "number")
              .data("data-column", value)
              .addClass("form-control"));

          $("#txtColumn").val("");

          fn_build_table();
      }

      function fn_build_table() {

          if (objDatos.Demandas_col.length > 0 && objDatos.Categorias_row.length > 0) {
              tHead.empty();
              trHead = $("<tr />").attr("style", "background-color: #3a3a3a;font-size: 20px;color: white;font-weight: bold;");

              $.each(objDatos.Demandas_col, function (k, a) {
                  td = $("<td />").append(a.Nombre);
                  trHead.append(td);
              });

              tHead.append(trHead);
              tBody.empty();

              $.each(objDatos.Categorias_row, function (k, a) {
                  tr = $("<tr />");
                  tdName = $("<td />").append(a).attr("style", "background-color: #3a3a3a;font-size: 20px;color: white;font-weight: bold;");;
                  tr.append(tdName);
                  for (x = 0; x <= objDatos.Demandas_col.length - 2; x++) {
                      tdValue = $("<td />").addClass("td-value").append("0")
                          .data("data-position", x + 1)
                          .data("data-obj", { Position: x + 1, Category: a, Value: 0 })

                          .attr("contenteditable", "true")

                      tr.append(tdValue);

                      var isAdd = true;
                      if (objDatos.Datos.length > 0) {
                          for (y = 0; y <= objDatos.Datos.length - 1; y++) {
                              if (objDatos.Datos[y].Position == (x + 1) && objDatos.Datos[y].Category == a) {
                                  isAdd = false;
                                  break;
                              }
                          }
                      }

                      if (isAdd) {
                          objDatos.Datos.push({ Position: x + 1, Category: a, Value: 0 });
                      }
                  }

                  tBody.append(tr);
              });

              fn_reload_values();
              fn_add_input_pesos();
          }
      }

      function fn_set_values() {
          var td = $(this);

          var dataObj = td.data("data-obj");
          dataObj.Value = parseFloat(td.text());
          td.data("data-obj", dataObj);
          $.each(objDatos.Datos, function (key, a) {
              if (a.Category == dataObj.Category && a.Position == dataObj.Position) {
                  a.Value = dataObj.Value;
              }
          });
      }

      function fn_reload_values() {
          $(".td-value").each(function () {
              var dataObj = $(this).data("data-obj");
              var value = Enumerable.from(objDatos.Datos)
                  .where(function (x) { return x.Category == dataObj.Category && x.Position == dataObj.Position })
                  .firstOrDefault()
              $(this).text(value.Value);
          });

      }

      function fn_add_input_pesos() {
          var cont = 0;
          $("#divPesos").each(function () {
              div = $("<div />").addClass("col-sm-2");
              div.append(objDatos.Pesos[cont]);
              cont++;
              $("#divPesos").append(div);
          });
      }

      $(document).on('focusout', '.td-value', fn_set_values);
      $(document).on('click', '#btnDemanda', fn_add_demanda);
      $(document).on('click', '#btnCatgoria', fn_add_categoria);
  </script>
</body>

</html>